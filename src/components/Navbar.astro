---
import RumboLogo from "../assets/logos/rumbo-logo.svg";
---

<!-- Overlay para cerrar el menú (cubre toda la página) -->
<div
  class="fixed inset-0 bg-black/40 z-40 opacity-0 invisible lg:hidden"
  id="nav-overlay"
></div>

<!-- Contenedor completo del Navbar (header + menú) -->
<div class="fixed inset-0 z-50 flex flex-col pointer-events-none" id="nav-container">
  
  <!-- Header (siempre visible, arriba) -->
  <header class="w-full pointer-events-auto">
    <div class="flex items-center justify-between px-4 py-3 lg:px-8 lg:py-4 mx-auto max-w-[1600px]">
      <!-- Logo -->
      <a href="#" class="px-3 py-2 h-14 flex items-center text-[#774F4F]" id="nav-logo">
        <RumboLogo class="h-10 w-auto max-h-10 lg:h-12"/>
      </a>

      <!-- Desktop Navigation -->
      <nav class="hidden lg:flex items-center gap-3">
      <a
        href="#services"
        class="desktop-nav-link bg-[#E0D7D3] text-[#774F4F] px-4 py-2 text-sm font-archive tracking-wide border-2 border-[#774F4F] hover:bg-[#774F4F] hover:text-[#E0D7D3] transition-colors"
      >
        SERVICIOS
      </a>
      <a
        href="#projects"
        class="desktop-nav-link bg-[#E0D7D3] text-[#774F4F] px-4 py-2 text-sm font-archive tracking-wide border-2 border-[#774F4F] hover:bg-[#774F4F] hover:text-[#E0D7D3] transition-colors"
      >
        PROYECTOS
      </a>
      <a
        href="#about-us"
        class="desktop-nav-link bg-[#E0D7D3] text-[#774F4F] px-4 py-2 text-sm font-archive tracking-wide border-2 border-[#774F4F] hover:bg-[#774F4F] hover:text-[#E0D7D3] transition-colors"
      >
        NOSOTROS
      </a>
      <a
        href="#contact"
        class="desktop-nav-link bg-[#E0D7D3] text-[#774F4F] px-4 py-2 text-sm font-archive tracking-wide border-2 border-[#774F4F] hover:bg-[#774F4F] hover:text-[#E0D7D3] transition-colors"
      >
        CONTACTO
      </a>
      <a
        href="#contact"
        class="desktop-nav-cta bg-[#774F4F] text-[#E0D7D3] px-6 py-2 text-sm font-archive tracking-wide border-2 border-[#774F4F] hover:bg-[#5a3b3b] transition-colors ml-2"
      >
        COMENZAR PROYECTO
      </a>
    </nav>

    <!-- Mobile Menu Button -->
    <button
      class="lg:hidden bg-[#E0D7D3] text-[#774F4F] px-2 py-1 text-lg font-archive tracking-wide border-2 border-[#774F4F]"
      id="hamburger-btn"
    >
      MENU +
    </button>
    </div>
  </header>

  <!-- Espaciador flexible (empuja el menú hacia abajo) -->
  <div class="flex-1"></div>

  <!-- Bottom Menu (Mobile only) -->
  <div
    class="lg:hidden m-4 bg-[#774F4F] flex flex-col border-2 border-[#E0D7D3] opacity-0 invisible transform translate-y-full pointer-events-auto"
    id="dropdown-nav"
  >
    <!-- Links de navegación -->
    <div class="flex flex-col px-6 py-6">
      <nav class="flex flex-col gap-2">
        <a
          href="#home"
          class="nav-item text-4xl font-black text-[#E0D7D3] font-archive tracking-tight opacity-0 translate-y-4"
          >INICIO</a
        >
        <a
          href="#projects"
          class="nav-item text-4xl font-black text-[#E0D7D3] font-archive tracking-tight opacity-0 translate-y-4"
          >TRABAJO</a
        >
        <a
          href="#about-us"
          class="nav-item text-4xl font-black text-[#E0D7D3] font-archive tracking-tight opacity-0 translate-y-4"
          >NOSOTROS</a
        >
        <a
          href="#services"
          class="nav-item text-4xl font-black text-[#E0D7D3] font-archive tracking-tight opacity-0 translate-y-4"
          >SERVICIOS</a
        >
        <a
          href="#contact"
          class="nav-item text-4xl font-black text-[#E0D7D3] font-archive tracking-tight opacity-0 translate-y-4"
          >CONTACTO</a
        >
      </nav>
    </div>

    <!-- Footer del menú con info de contacto -->
    <div class="px-6 py-4 mt-10">
      <div class="flex flex-col">
        <a
          href="mailto:rumbocomunicacion1@gmail.com"
          class="hover:opacity-75 transition-opacity text-[#E0D7D3] font-bold text-lg font-archive mb-2"
        >
          RUMBOCOMUNICACION1@GMAIL.COM
        </a>
        <div
          class="flex flex-row gap-4 text-[#E0D7D3] font-bold text-lg font-archive items-end"
        >
          <p>BUENOS AIRES, ARGENTINA</p>
          <a
            href="https://www.instagram.com/rumbo.comunicacion"
            target="_blank"
            rel="noopener noreferrer"
            class="text-[#E0D7D3] font-bold text-lg font-archive hover:opacity-75 transition-opacity flex flex-1 justify-end"
          >
            INSTAGRAM
          </a>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  import gsap from "gsap";

  const hamburgerBtn = document.getElementById(
    "hamburger-btn"
  ) as HTMLButtonElement | null;
  const dropdownNav = document.getElementById(
    "dropdown-nav"
  ) as HTMLElement | null;
  const navOverlay = document.getElementById(
    "nav-overlay"
  ) as HTMLElement | null;
  const navLogo = document.getElementById(
    "nav-logo"
  ) as HTMLElement | null;
  const navItems = document.querySelectorAll<HTMLElement>(".nav-item");

  let isNavOpen = false;
  let scrollPosition = 0;
  let isFooterVisible = false;

  // Colores del logo
  const logoColorDefault = "text-[#774F4F]";
  const logoColorWhite = "text-[#E0D7D3]";

  function setLogoColor(isWhite: boolean): void {
    if (!navLogo) return;
    if (isWhite) {
      navLogo.classList.remove(logoColorDefault);
      navLogo.classList.add(logoColorWhite);
    } else {
      navLogo.classList.remove(logoColorWhite);
      navLogo.classList.add(logoColorDefault);
    }
  }

  function openNav(): void {
    if (isNavOpen) return;
    isNavOpen = true;

    // Guardar posición actual del scroll
    scrollPosition = window.scrollY;

    // Bloquear scroll
    document.body.style.overflow = "hidden";
    document.body.style.position = "fixed";
    document.body.style.width = "100%";
    document.body.style.top = `-${scrollPosition}px`;

    // Cambiar texto del botón
    if (hamburgerBtn) {
      hamburgerBtn.textContent = "CERRAR -";
    }

    // Cambiar logo a blanco
    setLogoColor(true);

    const tl = gsap.timeline();

    // Mostrar overlay
    if (navOverlay) {
      tl.set(navOverlay, { visibility: "visible" }).to(navOverlay, {
        opacity: 1,
        duration: 0.3,
        ease: "power2.out",
      });
    }

    // Mostrar dropdown (desde abajo)
    if (dropdownNav) {
      tl.set(dropdownNav, { visibility: "visible" }, 0).to(
        dropdownNav,
        {
          opacity: 1,
          y: 0,
          duration: 0.4,
          ease: "power2.out",
        },
        0
      );
    }

    // Animar items
    tl.to(
      navItems,
      {
        opacity: 1,
        y: 0,
        duration: 0.3,
        stagger: 0.05,
        ease: "power3.out",
      },
      "-=0.1"
    );
  }

  function closeNav(): void {
    if (!isNavOpen) return;
    isNavOpen = false;

    // Restaurar scroll a la posición guardada
    document.body.style.overflow = "";
    document.body.style.position = "";
    document.body.style.width = "";
    document.body.style.top = "";
    window.scrollTo(0, scrollPosition);

    // Cambiar texto del botón
    if (hamburgerBtn) {
      hamburgerBtn.textContent = "MENU +";
    }

    // Restaurar logo (blanco si footer visible, default si no)
    setLogoColor(isFooterVisible);

    const tl = gsap.timeline();

    tl.to(navItems, {
      opacity: 0,
      y: 10,
      duration: 0.15,
      stagger: 0.02,
      ease: "power2.in",
    });

    if (dropdownNav) {
      tl.to(
        dropdownNav,
        {
          opacity: 0,
          y: -10,
          duration: 0.2,
          ease: "power2.in",
        },
        "-=0.1"
      ).set(dropdownNav, { visibility: "hidden" });
    }

    if (navOverlay) {
      tl.to(
        navOverlay,
        {
          opacity: 0,
          duration: 0.2,
          ease: "power2.in",
        },
        "-=0.2"
      ).set(navOverlay, { visibility: "hidden" });
    }
  }

  function toggleNav(): void {
    if (isNavOpen) {
      closeNav();
    } else {
      openNav();
    }
  }

  hamburgerBtn?.addEventListener("click", toggleNav);
  navOverlay?.addEventListener("click", closeNav);

  document.addEventListener("keydown", (e: KeyboardEvent) => {
    if (e.key === "Escape" && isNavOpen) {
      closeNav();
    }
  });

  navItems.forEach((item) => {
    item.addEventListener("click", () => {
      closeNav();
    });
  });

  // Intersection Observer para cambiar logo cuando el footer es visible
  const footer = document.querySelector("footer");
  
  if (footer && navLogo) {
    const observerOptions = {
      root: null,
      rootMargin: "0px",
      threshold: 0.95 // Se activa cuando 95% del footer es visible (casi todo)
    };

    const footerObserver = new IntersectionObserver((entries) => {
      entries.forEach((entry) => {
        isFooterVisible = entry.isIntersecting;
        
        // Solo cambiar si el menú no está abierto
        if (!isNavOpen) {
          setLogoColor(isFooterVisible);
        }
      });
    }, observerOptions);

    footerObserver.observe(footer);
  }
</script>
